# 譜面フォーマット

## 1.概要

BillionSequencerで読み込める譜面データの仕様です。サンプルデータはこのMarkdownファイルと同じフォルダの`samplesequence.json`を参照してください。

## 2. 仕様

BillionSequencerではJSON形式で譜面を管理します。JSONはテキストエディタでの手書きもしくは譜面エディタで記述します。
譜面の仕様は大きく4パートに分かれます。

### 2.1. 凡例

仕様内の表記は以下に対応します。

| 用語     | 品詞   | 説明                                                         |
| -------- | ------ | ------------------------------------------------------------ |
| 譜面     | 名詞   | 楽曲に合わせて降ってくるオブジェクトが定義されたテキストデータ。 |
| ノーツ   | 名詞   | 楽曲に合わせて降ってくるオブジェクト。                       |
| 叩く     | 動詞   | 振ってくるノーツに対応する行動を取ること。                   |
| コンボ   | 動詞？ | ノーツをミスせず叩けた数。ミスをするとリセットされる。       |
| ゲージ   | 名詞   | 譜面クリアの可否判定の基準となる値。ノーツをタイミングよく叩くと増え、ミスをすると減る。 |
| 判定     | 名詞   | ノーツを叩いたタイミングが、本来叩くべきタイミングからどれだけ離れているかを文字列で表したもの。 |
| required | 名詞   | かならず設定しなければいけない設定を示す。                   |
| integer  | 名詞   | 整数型を示す。                                               |
| string   | 名詞   | 文字列型を示す。                                             |
| float    | 名詞   | 実数を示す。                                                 |
| boolean  | 名詞   | 真偽値型を示す。                                             |
| object   | 名詞   | オブジェクト型を示す。                                       |

### 2.2. 譜面の全体設定 - global_configurations

このパートでは、譜面全体にかかわる設定を記述します。

#### string title `required`

楽曲のタイトル。

#### string artist 

楽曲のアーティスト。

#### string sequence_designer

譜面制作者。

#### string artwork

譜面ファイルがあるディレクトリから見た、画像ファイルまでのパス。基本的に譜面ファイルと同じファイルを指定することを推奨。

JPGとPNGが設定可能。

#### integer lane_count `required` 

レーン数。指定できる値は1以上6以下の自然数。

#### string background_sound_file

譜面を再生中に流れる音声。WAVとMP3が指定可能。

#### integer gauge_replenishment_base_amount `required`

ゲージ回復量。1ノーツあたりの回復量は`gauge_replenishment_base_amount/総ノーツ数`で計算される。

#### string required_precision_for_judgement `required`

判定の広さ。設定できる値は以下の通り

- low：広い
- medium：普通
- high：狭い
- extremely_high：とても狭い

TODO: 具体的な判定のフレームを書く？

### 2.3. 小節設定 - measure_magnifications

 このパートでは、小節の設定を行います。

#### 2.3.1. 小節の考え方

4/4拍子を基準に考えます。

4/4拍子の時の小節の長さを1とした時、3/4拍子の小節の長さは相対的に3/4=0.75であるとします。BillionSequencerではこの相対的な実数を設定して小節の拍子を管理します。

#### 2.3.2. 設定

##### integer measure `required`

小節番号。

##### float magnification `required`

小節の相対的な長さ。

### 2.4. BPM推移 - bpm_transitions

このパートでは、BPM推移の設定を行います。

#### integer measure `required`

小節番号。

#### integer|float bpm `required`

BPM。

### 2.5. ノーツ - notes

このパートでは、ノーツの管理をします。

#### 2.5.1. 単押し

##### 2.5.1.1. 定義

単押しとは、一度の操作のみを行うことによって叩ききることのできるノーツを指します。

##### 2.5.1.2. 設定

###### integer measure `required`

小節番号。

###### integer beat `required`

拍数。

###### integer beat_unit `required`

拍数の基準となる音価。`measure_magnifications.magnification/beat_unit*beat`の位置にノーツが配置される。

###### integer lane `required`

ノーツが配置されるレーン。0以上`global_configurations.lane_count-1`の値が設定できる。

0が一番左のレーンで、`global_configurations.lane_count-1`が一番右のレーン。

###### integer spawn_lane

ノーツが出現するレーン。ノーツが`spawn_lane`から`lane`まで移動するラインは補間されて描画される。

###### float velocity_multiplier

ノーツが降ってくる速さの係数。

#### 2.5.2. フリック

##### 2.5.2.1. 定義

フリックとは、ノーツを叩いた後、指定された方向への入力が要求されるノーツです。

ノーツを叩いても指定された方向への入力が失敗した場合にはミスとなります。

##### 2.5.2.2. 設定

###### integer measure `required`

小節番号。

###### integer beat `required`

拍数。

###### integer beat_unit `required`

拍数の基準となる音価。`measure_magnifications.magnification/beat_unit*beat`の位置にノーツが配置される。

###### integer lane `required`

ノーツが配置されるレーン。0以上`global_configurations.lane_count-1`の値が設定できる。

0が一番左のレーンで、`global_configurations.lane_count-1`が一番右のレーン。

###### object flick `required`

フリックの設定を行う。

string flick.direction `required`

フリックの向きを指定する。以下の値が設定可能。

- up 上方向
- down 下方向
- left 左方向
- right 右方向

###### integer spawn_lane

ノーツが出現するレーン。ノーツが`spawn_lane`から`lane`まで移動するラインは補間されて描画される。

###### float velocity_multiplier

ノーツが降ってくる速さの係数。

#### 2.5.3. 長押し

##### 2.5.3.1. 定義

長押しとは、始点と終点の概念を持つノーツです。

このノーツは、以下の条件がすべて満たされた場合に成功となります。

- ゲーム仕様にて示される判定枠のうち、コンボが継続される判定で始点のノーツを叩けた
- 上記の動作が成功した後、終点までその入力状態が継続された
- 終点のタイミングで、コンボが継続される判定で終点のノーツを離せた

##### 2.5.3.2. 始点の設定

###### integer measure `required`

小節番号。

###### integer beat `required`

拍数。

###### integer beat_unit `required`

拍数の基準となる音価。`measure_magnifications.magnification/beat_unit*beat`の位置にノーツが配置される。

###### integer lane `required`

ノーツが配置されるレーン。0以上`global_configurations.lane_count-1`の値が設定できる。

0が一番左のレーンで、`global_configurations.lane_count-1`が一番右のレーン。

###### boolean starts_long `required`

始点を表すノーツであることを示すフラグ。

##### 2.5.3.3. 終点の設定

`3.4.1. 単押し` もしくは`3.4.2. フリック`のオブジェクトを始点より後のタイミングかつ同じレーンに設定することで配置されます。

その特性上、長押しの途中で同じレーンに他のオブジェクトを含めることはできません。

#### 2.5.4. 視覚効果ノーツ

##### 2.5.4.1. 定義

視覚効果ノーツとは、ノーツを叩くことに成功した場合に視覚的な効果を発生させるノーツです。始点のみに判定が存在し、終点は動作を必要としません。

##### 2.5.4.2. 始点の設定

###### integer measure `required`

小節番号。

###### integer beat `required`

拍数。

###### integer beat_unit `required`

拍数の基準となる音価。`measure_magnifications.magnification/beat_unit*beat`の位置にノーツが配置される。

###### integer lane `required`

ノーツが配置されるレーン。0以上`global_configurations.lane_count-1`の値が設定できる。

0が一番左のレーンで、`global_configurations.lane_count-1`が一番右のレーン。

###### boolean starts_effect `required`

視覚効果の始点であることを示すフラグ。

###### object effect `required`

視覚効果の設定。

###### object effect.drawer `required`

視覚効果の設定。現在`burst`のみが設定可能。

##### 2.5.4.3. 終点の設定

始点より後のタイミングかつ`-1`レーンに単押しを置くことによって視覚効果の終点を設定できます。